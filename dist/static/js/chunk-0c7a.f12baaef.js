(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-0c7a"],{"/f5E":function(e,t,a){"use strict";a.d(t,"b",function(){return c}),a.d(t,"a",function(){return s});var r=a("t3Un"),i="/binds";function c(e){return Object(r.a)({url:i,method:"PUT",data:e})}function s(e){return Object(r.a)({url:i,method:"DELETE",data:e})}},"/kzY":function(e,t,a){},PT6R:function(e,t,a){"use strict";var r=a("JDVc"),i=a("qiID"),c=a("fqLP"),s=a("/f5E"),n=a("7Qib");function o(){return{id:void 0,addr:"",protocol:r.r.http,maxQPS:void 0,rateLimitOption:r.t.wait,heathCheck:{path:"",body:"",checkInterval:0,checkIntervalType:r.C.second,timeout:0,timeoutType:r.C.second},circuitBreaker:{closeTimeout:0,closeTimeoutType:r.C.second,rateCheckPeriod:0,rateCheckPeriodType:r.C.second,halfTrafficRate:"",failureRateToClose:"",succeedRateToOpen:""},bindClusterId:"",bindClusterName:""}}var l={name:"serverForm",props:{showType:{type:String,default:r.d.create},editItem:{type:Object}},data:function(){return{loading:!0,submitting:!1,circuitBreakerConstant:r.a,protocolConstant:r.q,timeTypeConstant:r.A,rateLimitOptionConstant:r.s,rules:{bindClusterId:[{required:!0,message:"请选择集群",trigger:"change"}],addr:[{required:!0,message:"请填写地址",trigger:"change"},{min:5,max:255,message:"长度请控制在 5 - 255",trigger:"change"}],maxQPS:[{required:!0,message:"请填写支持的最大QPS",trigger:"change"},{type:"number",min:1,message:"数值必须大于0",trigger:"change"}]},tempItem:o(),clustersList:[],needHeathCheck:!1,needCircuitBreaker:!1}},computed:{isShow:function(){return this._isShow()},isCreate:function(){return this._isCreate()},isUpdate:function(){return this._isUpdate()}},created:function(){this.init()},watch:{editItem:function(e,t){var a=Object(n.d)(o(),Object(n.a)(e));this._isShow()||(a.heathCheck.path&&(this.needHeathCheck=!0),a.circuitBreaker.halfTrafficRate&&(this.needCircuitBreaker=!0),a.heathCheck.checkInterval&&(a.heathCheck.checkInterval=Object(n.m)(a.heathCheck.checkInterval)),a.heathCheck.timeout&&(a.heathCheck.timeout=Object(n.m)(a.heathCheck.timeout)),a.circuitBreaker.closeTimeout&&(a.circuitBreaker.closeTimeout=Object(n.m)(a.circuitBreaker.closeTimeout)),a.circuitBreaker.rateCheckPeriod&&(a.circuitBreaker.rateCheckPeriod=Object(n.m)(a.circuitBreaker.rateCheckPeriod)),a.heathCheck.checkIntervalType=r.C.second,a.heathCheck.timeoutType=r.C.second,a.circuitBreaker.closeTimeoutType=r.C.second,a.circuitBreaker.rateCheckPeriodType=r.C.second),this.tempItem=a,this.loading=!1,this.submitting=!1}},methods:{init:function(){var e=this;this._isShow()?(this.rules={},this.needHeathCheck=!0,this.needCircuitBreaker=!0):this._isCreate()&&(this.loading=!1,this.tempItem=Object(n.d)(this.tempItem,Object(n.a)(this.editItem))),c.b().then(function(t){e.clustersList=t||[],e._isShow()&&e.initShow()})},initShow:function(){if(this.tempItem.bindClusterId)for(var e=0,t=this.clustersList.length;e<t;e++){var a=this.clustersList[e];a.id==this.tempItem.bindClusterId&&(this.tempItem.bindClusterName=a.name)}},goList:function(){this.$router.replace({path:"/server",query:{id:this.tempItem.bindClusterId}}),this.$destroy()},goEdit:function(){this.$router.push({path:"/server/edit",query:{id:this.tempItem.id,clusterId:this.tempItem.bindClusterId}}),this.$destroy()},createItem:function(e){var t=this;this.submitting||this.$refs[e].validate(function(e){if(!e)return!1;t._doCreateItem()})},_doCreateItem:function(){var e=this,t=this._formatFormData();t&&(this.submitting=!0,i.c(t).then(function(t){var a={clusterID:e.tempItem.bindClusterId,serverID:t};s.b(a).then(function(){e.$message({type:"success",message:"创建成功!"}),setTimeout(function(){e.goList()},2e3)}).catch(function(){e.submitting=!0})}))},updateItem:function(e){var t=this;this.submitting||this.$refs[e].validate(function(e){if(!e)return!1;t._doUpdateItem()})},_doUpdateItem:function(){var e=this,t=this._formatFormData();t&&(this.submitting=!0,i.c(t).then(function(t){var a={clusterID:e.tempItem.bindClusterId,serverID:t};s.b(a).then(function(){e.$message({type:"success",message:"修改成功!"}),setTimeout(function(){e.goList()},2e3)}).catch(function(){e.submitting=!1})}))},_formatFormData:function(){var e=Object(n.a)(this.tempItem);if(e.id||delete e.id,e.addr&&(e.addr=e.addr.replace("：",":"),-1===e.addr.indexOf(":")&&(e.addr=e.addr+":80")),e.heathCheck.timeout=Object(n.l)(e.heathCheck.timeout,e.heathCheck.timeoutType),e.heathCheck.checkInterval=Object(n.l)(e.heathCheck.checkInterval,e.heathCheck.checkIntervalType),e.circuitBreaker.rateCheckPeriod=Object(n.l)(e.circuitBreaker.rateCheckPeriod,e.circuitBreaker.rateCheckPeriodType),e.circuitBreaker.closeTimeout=Object(n.l)(e.circuitBreaker.closeTimeout,e.circuitBreaker.closeTimeoutType),this.needHeathCheck){if(!e.heathCheck.path)return this._showMessage("填写健康检查机制的检查路径字段"),!1;if(!e.heathCheck.checkInterval)return this._showMessage("填写健康检查机制的间隔时间字段"),!1;if(!e.heathCheck.timeout)return this._showMessage("填写健康检查机制的超时时间字段"),!1}else delete e.heathCheck;if(this.needCircuitBreaker){if(!e.circuitBreaker.closeTimeout)return this._showMessage("填写熔断规则的间隔时间字段"),!1;if(!e.circuitBreaker.rateCheckPeriod)return this._showMessage("填写熔断规则的检查周期字段"),!1;if(!e.circuitBreaker.halfTrafficRate)return this._showMessage("填写熔断规则的Half限流百分比字段"),!1;if(!e.circuitBreaker.failureRateToClose)return this._showMessage("填写熔断规则的Open -> Close的错误百分比字段"),!1;if(!e.circuitBreaker.succeedRateToOpen)return this._showMessage("填写熔断规则的Half -> Open的成功百分比字段"),!1}else delete e.circuitBreaker;return e},_showMessage:function(e){this.$message({type:"warning",message:e})},_isUpdate:function(){return this.showType===r.d.update},_isShow:function(){return this.showType===r.d.show},_isCreate:function(){return this.showType===r.d.create}}},u=(a("RLX9"),a("KHd+")),h=Object(u.a)(l,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"dataForm",attrs:{rules:e.rules,model:e.tempItem,"label-width":"150px"}},[a("el-form-item",{attrs:{label:"集群",prop:"bindClusterId"}},[e.isShow?a("span",[e._v(e._s(e.tempItem.bindClusterName))]):[a("el-select",{model:{value:e.tempItem.bindClusterId,callback:function(t){e.$set(e.tempItem,"bindClusterId",t)},expression:"tempItem.bindClusterId"}},e._l(e.clustersList,function(e,t){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)]],2),e._v(" "),a("el-form-item",{attrs:{label:"地址",prop:"addr"}},["show"==e.showType?a("span",[e._v(e._s(e.tempItem.addr))]):a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:'"IP:PORT",默认80端口'},model:{value:e.tempItem.addr,callback:function(t){e.$set(e.tempItem,"addr",t)},expression:"tempItem.addr"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"接口协议"}},[e.isShow?a("span",[e._v(e._s(e._f("protocolFilter")(e.tempItem.protocol)))]):[a("el-select",{staticStyle:{width:"200px"},attrs:{placeholder:"Server的接口协议"},model:{value:e.tempItem.protocol,callback:function(t){e.$set(e.tempItem,"protocol",t)},expression:"tempItem.protocol"}},e._l(e.protocolConstant,function(e){return a("el-option",{key:e.value,attrs:{value:e.value,label:e.title}})}),1)]],2),e._v(" "),a("el-form-item",{attrs:{label:"支持的最大QPS",prop:"maxQPS"}},["show"==e.showType?[a("span",[e._v(e._s(e.tempItem.maxQPS))]),e._v(" "),a("span",[e._v("超载: "+e._s(e._f("rateLimitOptionFilter")(e.tempItem.rateLimitOption)))])]:[a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"用于流控"},model:{value:e.tempItem.maxQPS,callback:function(t){e.$set(e.tempItem,"maxQPS",e._n(t))},expression:"tempItem.maxQPS"}}),e._v(" "),a("el-select",{staticStyle:{width:"100px"},model:{value:e.tempItem.rateLimitOption,callback:function(t){e.$set(e.tempItem,"rateLimitOption",e._n(t))},expression:"tempItem.rateLimitOption"}},e._l(e.rateLimitOptionConstant,function(e){return a("el-option",{key:e.value,attrs:{label:e.title,value:e.value}})}),1),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",placement:"top-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n                        超载类型：Wait(默认),Reject\n                    ")]),e._v(" "),a("i",{staticClass:"el-icon-info",staticStyle:{"margin-left":"10px",color:"#909399"}})])]],2),e._v(" "),a("el-form-item",{staticStyle:{width:"800px"},attrs:{label:"健康检查机制"}},[a("el-row",{directives:[{name:"show",rawName:"v-show",value:e.needHeathCheck,expression:"needHeathCheck"}]},[a("el-col",[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",staticStyle:{"line-height":"25px"},attrs:{slot:"header"},slot:"header"},[a("el-alert",{attrs:{closable:!1,title:"Server的健康检查机制，目前支持HTTP的协议检查，支持检查返回状态码以及返回内容。如果没有设置，认为这个Server的健康检查交给外部，Gateway永久认为这个Server是健康的。",type:"warning"}})],1),e._v(" "),a("el-row",[a("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:5}},[a("span",{staticClass:"red-icon"},[e._v("*")]),e._v(" 检查路径:\n                            ")]),e._v(" "),a("el-col",{attrs:{span:10}},[e.isShow?a("span",[e._v(e._s(e.tempItem.heathCheck.path))]):a("el-input",{attrs:{placeholder:"检测路径，如/ping"},model:{value:e.tempItem.heathCheck.path,callback:function(t){e.$set(e.tempItem.heathCheck,"path",t)},expression:"tempItem.heathCheck.path"}})],1)],1),e._v(" "),a("el-row",{staticClass:"el-margin-top"},[a("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:5}},[a("span",{staticClass:"red-icon"},[e._v("*")]),e._v("检测间隔时间:\n                            ")]),e._v(" "),a("el-col",{attrs:{span:10}},[e.isShow?a("span",[e._v(e._s(e._f("toSecondFilter")(e.tempItem.heathCheck.checkInterval)))]):a("el-input",{attrs:{placeholder:"请填写"},model:{value:e.tempItem.heathCheck.checkInterval,callback:function(t){e.$set(e.tempItem.heathCheck,"checkInterval",e._n(t))},expression:"tempItem.heathCheck.checkInterval"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:e.tempItem.heathCheck.checkIntervalType,callback:function(t){e.$set(e.tempItem.heathCheck,"checkIntervalType",t)},expression:"tempItem.heathCheck.checkIntervalType"}},e._l(e.timeTypeConstant,function(e){return a("el-option",{key:e.value,attrs:{value:e.value,label:e.title}})}),1)],1)],1)],1),e._v(" "),a("el-row",{staticClass:"el-margin-top"},[a("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:5}},[a("span",{staticClass:"red-icon"},[e._v("*")]),e._v("检测超时时间:\n                            ")]),e._v(" "),a("el-col",{attrs:{span:10}},[e.isShow?a("span",[e._v(e._s(e._f("toSecondFilter")(e.tempItem.heathCheck.timeout)))]):a("el-input",{attrs:{placeholder:"请填写"},model:{value:e.tempItem.heathCheck.timeout,callback:function(t){e.$set(e.tempItem.heathCheck,"timeout",e._n(t))},expression:"tempItem.heathCheck.timeout"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:e.tempItem.heathCheck.timeoutType,callback:function(t){e.$set(e.tempItem.heathCheck,"timeoutType",t)},expression:"tempItem.heathCheck.timeoutType"}},e._l(e.timeTypeConstant,function(e){return a("el-option",{key:e.value,attrs:{value:e.value,label:e.title}})}),1)],1)],1)],1),e._v(" "),a("el-row",{staticClass:"el-margin-top"},[a("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:5}},[e._v("返回内容:\n                            ")]),e._v(" "),a("el-col",{attrs:{span:10}},[e.isShow?a("span",[e._v(e._s(e.tempItem.heathCheck.body))]):a("el-input",{attrs:{placeholder:"返回内容",type:"textarea"},model:{value:e.tempItem.heathCheck.body,callback:function(t){e.$set(e.tempItem.heathCheck,"body",t)},expression:"tempItem.heathCheck.body"}})],1)],1)],1),e._v(" "),e.isShow?e._e():a("el-button",{attrs:{type:"text"},on:{click:function(t){e.needHeathCheck=!1}}},[e._v("移除健康检查机制")])],1)],1),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.needHeathCheck,expression:"!needHeathCheck"}],attrs:{type:"text"},on:{click:function(t){e.needHeathCheck=!0}}},[e._v("添加健康检查机制\n            ")])],1),e._v(" "),a("el-form-item",{staticStyle:{width:"800px"},attrs:{label:"熔断器设置"}},[a("el-row",{directives:[{name:"show",rawName:"v-show",value:e.needCircuitBreaker,expression:"needCircuitBreaker"}]},[a("el-col",[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",staticStyle:{"line-height":"25px"},attrs:{slot:"header"},slot:"header"},[a("el-alert",{attrs:{closable:!1,title:"熔断器，设置后端Server的熔断规则。熔断器分为3个状态： Open、Half、Close",type:"warning"}})],1),e._v(" "),a("el-row",[a("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:8}},[a("span",{staticClass:"red-icon"},[e._v("*")]),e._v("关闭检查间隔时间:\n                            ")]),e._v(" "),a("el-col",{attrs:{span:10}},[e.isShow?a("span",[e._v(e._s(e._f("toSecondFilter")(e.tempItem.circuitBreaker.closeTimeout)))]):a("el-input",{attrs:{placeholder:"请填写"},model:{value:e.tempItem.circuitBreaker.closeTimeout,callback:function(t){e.$set(e.tempItem.circuitBreaker,"closeTimeout",e._n(t))},expression:"tempItem.circuitBreaker.closeTimeout"}},[a("el-select",{staticStyle:{width:"100px"},attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:e.tempItem.circuitBreaker.closeTimeoutType,callback:function(t){e.$set(e.tempItem.circuitBreaker,"closeTimeoutType",t)},expression:"tempItem.circuitBreaker.closeTimeoutType"}},e._l(e.timeTypeConstant,function(e){return a("el-option",{key:e.value,attrs:{value:e.value,label:e.title}})}),1)],1)],1)],1),e._v(" "),a("el-row",{staticClass:"el-margin-top"},[a("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:8}},[a("span",{staticClass:"red-icon"},[e._v("*")]),e._v("熔断器检查周期:\n                            ")]),e._v(" "),a("el-col",{attrs:{span:10}},[e.isShow?a("span",[e._v(e._s(e._f("toSecondFilter")(e.tempItem.circuitBreaker.rateCheckPeriod)))]):a("el-input",{attrs:{placeholder:"请填写"},model:{value:e.tempItem.circuitBreaker.rateCheckPeriod,callback:function(t){e.$set(e.tempItem.circuitBreaker,"rateCheckPeriod",e._n(t))},expression:"tempItem.circuitBreaker.rateCheckPeriod "}},[a("el-select",{staticStyle:{width:"100px"},attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:e.tempItem.circuitBreaker.rateCheckPeriodType,callback:function(t){e.$set(e.tempItem.circuitBreaker,"rateCheckPeriodType",t)},expression:"tempItem.circuitBreaker.rateCheckPeriodType"}},e._l(e.timeTypeConstant,function(e){return a("el-option",{key:e.value,attrs:{value:e.value,label:e.title}})}),1)],1)],1)],1),e._v(" "),a("el-row",{staticClass:"el-margin-top"},[a("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:8}},[a("span",{staticClass:"red-icon"},[e._v("*")]),e._v("Half限流百分比:\n                            ")]),e._v(" "),a("el-col",{attrs:{span:10}},[e.isShow?a("span",[e._v(e._s(e.tempItem.circuitBreaker.halfTrafficRate))]):a("el-input",{attrs:{placeholder:"区间：1-100"},model:{value:e.tempItem.circuitBreaker.halfTrafficRate,callback:function(t){e.$set(e.tempItem.circuitBreaker,"halfTrafficRate",e._n(t))},expression:"tempItem.circuitBreaker.halfTrafficRate"}})],1)],1),e._v(" "),a("el-row",{staticClass:"el-margin-top"},[a("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:8}},[a("span",{staticClass:"red-icon"},[e._v("*")]),e._v("Open -> Close的错误百分比:\n                            ")]),e._v(" "),a("el-col",{attrs:{span:10}},[e.isShow?a("span",[e._v(e._s(e.tempItem.circuitBreaker.failureRateToClose))]):a("el-input",{attrs:{placeholder:"区间：1-100"},model:{value:e.tempItem.circuitBreaker.failureRateToClose,callback:function(t){e.$set(e.tempItem.circuitBreaker,"failureRateToClose",e._n(t))},expression:"tempItem.circuitBreaker.failureRateToClose"}})],1)],1),e._v(" "),a("el-row",{staticClass:"el-margin-top"},[a("el-col",{staticStyle:{"text-align":"right","padding-right":"8px"},attrs:{span:8}},[a("span",{staticClass:"red-icon"},[e._v("*")]),e._v("Half -> Open的成功百分比:\n                            ")]),e._v(" "),a("el-col",{attrs:{span:10}},[e.isShow?a("span",[e._v(e._s(e.tempItem.circuitBreaker.succeedRateToOpen))]):a("el-input",{attrs:{placeholder:"区间：1-100"},model:{value:e.tempItem.circuitBreaker.succeedRateToOpen,callback:function(t){e.$set(e.tempItem.circuitBreaker,"succeedRateToOpen",e._n(t))},expression:"tempItem.circuitBreaker.succeedRateToOpen"}})],1)],1)],1),e._v(" "),e.isShow?e._e():a("el-button",{attrs:{type:"text"},on:{click:function(t){e.needCircuitBreaker=!1}}},[e._v("移除熔断规则")])],1)],1),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.needCircuitBreaker,expression:"!needCircuitBreaker"}],attrs:{type:"text"},on:{click:function(t){e.needCircuitBreaker=!0}}},[e._v("添加熔断规则\n            ")])],1),e._v(" "),a("div",{staticStyle:{"margin-left":"70px"}},[a("el-button",{on:{click:e.goList}},[e._v("返回")]),e._v(" "),"show"==e.showType?a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.goEdit("dataForm")}}},[e._v("编辑")]):"create"==e.showType?a("el-button",{attrs:{loading:e.submitting,type:"primary"},on:{click:function(t){e.createItem("dataForm")}}},[e._v("添加\n            ")]):"update"==e.showType?a("el-button",{attrs:{loading:e.submitting,type:"primary"},on:{click:function(t){e.updateItem("dataForm")}}},[e._v("修改\n            ")]):e._e()],1)],1)],1)},[],!1,null,"ee3f34bc",null);h.options.__file="ServerForm.vue";t.a=h.exports},RLX9:function(e,t,a){"use strict";var r=a("/kzY");a.n(r).a},fqLP:function(e,t,a){"use strict";a.d(t,"b",function(){return o}),a.d(t,"d",function(){return l}),a.d(t,"e",function(){return u}),a.d(t,"a",function(){return h}),a.d(t,"c",function(){return p});var r=a("4d7F"),i=a.n(r),c=a("t3Un"),s=a("JDVc"),n="/clusters";function o(){return new i.a(function(e,t){var a=[],r="",i=s.c;!function s(o){(function(e){return Object(c.a)({url:n,method:"GET",params:e})})(o).then(function(t){var c=(t=t||[]).length;c>0?(a=a.concat(t),(r=t[c-1]||{}).id&&s({after:r.id,limit:i})):e(a)}).catch(function(){t()})}({after:"",limit:i})})}function l(e){return Object(c.a)({url:n+"/"+e,method:"GET"})}function u(e){return Object(c.a)({url:n,method:"PUT",data:e})}function h(e){return Object(c.a)({url:n+"/"+e,method:"DELETE"})}function p(e){return Object(c.a)({url:n+"/"+e+"/binds",method:"GET"})}},qiID:function(e,t,a){"use strict";a.d(t,"b",function(){return c}),a.d(t,"c",function(){return s}),a.d(t,"a",function(){return n});a("4d7F");var r=a("t3Un"),i=(a("JDVc"),"/servers");function c(e){return Object(r.a)({url:i+"/"+e,method:"GET"})}function s(e){return Object(r.a)({url:i,method:"PUT",data:e})}function n(e){return Object(r.a)({url:i+"/"+e,method:"DELETE"})}},t3Un:function(e,t,a){"use strict";var r=a("4d7F"),i=a.n(r),c=a("vDqi"),s=a.n(c),n=a("XJYT"),o=s.a.create({baseURL:"/v1",timeout:6e4});o.interceptors.request.use(function(e){return e},function(e){console.error(e),i.a.reject(e)}),o.interceptors.response.use(function(e){var t=e.data||{};e.headers;return 0===t.code?t.data:(Object(n.Message)({message:t.data,type:"error",duration:5e3}),i.a.reject("error"))},function(e){return Object(n.Message)({message:e.response&&e.response.data&&e.response.data.data||"网络异常",type:"error",duration:5e3}),i.a.reject(e)}),t.a=o}}]);